"use strict";(self.webpackChunkstrengthjournal_app=self.webpackChunkstrengthjournal_app||[]).push([[146],{6146:(bt,v,d)=>{d.r(v),d.d(v,{WorkoutModule:()=>wt});var S=d(8505),b=d(4004),_=d(8745),t=d(5e3),Z=d(6580),U=d(520);let m=(()=>{class r extends Z._{constructor(e){super(e)}getWorkouts(e,o){return this.http.get(`${this.BASE_URL}/workouts?pageNumber=${e}&perPage=${o}`)}createWorkout(e){return this.http.post(`${this.BASE_URL}/workouts`,e)}getWorkout(e){return this.http.get(`${this.BASE_URL}/workouts/${e}`)}getWorkoutSets(e){return this.http.get(`${this.BASE_URL}/workouts/${e}/sets`)}syncSet(e,o){return this.http.put(`${this.BASE_URL}/workouts/${e}/sets`,o)}deleteSet(e,o){return this.http.delete(`${this.BASE_URL}/workouts/${e}/sets/${o}`)}updateWorkoutSetSequence(e,o){return this.http.put(`${this.BASE_URL}/workouts/${e}/set-sequence`,{setSequence:o})}updateWorkout(e,o){return this.http.put(`${this.BASE_URL}/workouts/${e}`,o)}deleteWorkout(e){return this.http.delete(`${this.BASE_URL}/workouts/${e}`)}}return r.\u0275fac=function(e){return new(e||r)(t.LFG(U.eN))},r.\u0275prov=t.Yz7({token:r,factory:r.\u0275fac,providedIn:"root"}),r})();var g=d(1958),f=d(3949),p=d(9808),E=d(4110),k=d(5201),y=d(2265);const D=function(r){return[r,"edit"]};function W(r,n){if(1&r){const e=t.EpF();t.TgZ(0,"tr")(1,"td")(2,"a",12),t._uU(3),t.ALo(4,"date"),t.qZA()(),t.TgZ(5,"td"),t._uU(6),t.qZA(),t.TgZ(7,"td",13)(8,"app-table-actions",14),t.NdJ("deleteClicked",function(){const s=t.CHM(e).$implicit;return t.oxw(2).deleteWorkout(s.id)}),t.qZA()()()}if(2&r){const e=n.$implicit;t.xp6(2),t.Q6J("routerLink",t.VKq(6,D,e.id)),t.xp6(1),t.Oqu(t.xi3(4,3,e.entryDateUTC,"short")),t.xp6(3),t.Oqu(e.title)}}function I(r,n){if(1&r&&(t.TgZ(0,"table",9)(1,"thead")(2,"tr")(3,"th"),t._uU(4,"Date"),t.qZA(),t.TgZ(5,"th"),t._uU(6,"Title"),t.qZA(),t.TgZ(7,"th",10),t._uU(8,"Action"),t.qZA()()(),t.TgZ(9,"tbody"),t.YNc(10,W,9,8,"tr",11),t.qZA()()),2&r){const e=n.ngIf;t.xp6(10),t.Q6J("ngForOf",e)}}function A(r,n){1&r&&(t.TgZ(0,"div",15)(1,"div",16)(2,"span",17),t._uU(3,"Loading..."),t.qZA()()())}function N(r,n){if(1&r){const e=t.EpF();t.TgZ(0,"app-confirm-delete",18),t.NdJ("dismissDeleteEvent",function(){return t.CHM(e),t.oxw().dismissDeleteWorkout()})("confirmDeleteEvent",function(){return t.CHM(e),t.oxw().confirmDeleteWorkout()}),t._uU(1," Deleting this workout will also delete all related sets. Are you sure you would like to continue?\n"),t.qZA()}}let F=(()=>{class r{constructor(e,o){this.workouts=e,this.router=o,this.page=1,this.pageSize=10,this.collectionSize=0,this.stagedDelete=null,this.subs=new _.Y}ngOnDestroy(){this.subs.unsubscribe()}getWorkoutPage(){this.workoutList$=this.workouts.getWorkouts(this.page,this.pageSize).pipe((0,S.b)(e=>this.collectionSize=e.totalRecords),(0,b.U)(e=>e.data))}ngOnInit(){this.getWorkoutPage()}deleteWorkout(e){this.stagedDelete=e}dismissDeleteWorkout(){this.stagedDelete=null}confirmDeleteWorkout(){if(null==this.stagedDelete)throw"Tried to finalize workout delete but no ID staged";this.subs.sink=this.workouts.deleteWorkout(this.stagedDelete).subscribe(()=>{this.getWorkoutPage(),this.stagedDelete=null})}editWorkout(e){this.router.navigate(["workouts",e,"edit"])}}return r.\u0275fac=function(e){return new(e||r)(t.Y36(m),t.Y36(g.F0))},r.\u0275cmp=t.Xpm({type:r,selectors:[["app-list-workouts"]],decls:13,vars:7,consts:[[1,"h3","mb-3"],[1,"row"],[1,"col-12"],["cardTitle","My Workout List"],["routerLink","new",1,"btn","btn-primary","buttons-copy","buttons-html5"],["class","table table-striped dataTable no-footer dtr-inline collapsed",4,"ngIf"],["workoutListLoading",""],[3,"page","pageSize","collectionSize","pageChange"],[3,"dismissDeleteEvent","confirmDeleteEvent",4,"ngIf"],[1,"table","table-striped","dataTable","no-footer","dtr-inline","collapsed"],[2,"width","10%"],[4,"ngFor","ngForOf"],[3,"routerLink"],[1,"table-action"],[3,"deleteClicked"],[1,"mb-2","text-center"],["role","status",1,"spinner-grow","me-2"],[1,"sr-only"],[3,"dismissDeleteEvent","confirmDeleteEvent"]],template:function(e,o){1&e&&(t.TgZ(0,"h1",0),t._uU(1,"Workouts"),t.qZA(),t.TgZ(2,"div",1)(3,"div",2)(4,"app-card",3)(5,"button",4),t._uU(6,"Log New Workout"),t.qZA(),t.YNc(7,I,11,1,"table",5),t.ALo(8,"async"),t.YNc(9,A,4,0,"ng-template",null,6,t.W1O),t.TgZ(11,"ngb-pagination",7),t.NdJ("pageChange",function(s){return o.page=s})("pageChange",function(){return o.getWorkoutPage()}),t.qZA()()()(),t.YNc(12,N,2,0,"app-confirm-delete",8)),2&e&&(t.xp6(7),t.Q6J("ngIf",t.lcZ(8,5,o.workoutList$)),t.xp6(4),t.Q6J("page",o.page)("pageSize",o.pageSize)("collectionSize",o.collectionSize),t.xp6(1),t.Q6J("ngIf",o.stagedDelete))},directives:[f.A,g.rH,p.O5,p.sg,g.yS,E.K,k.N9,y.h],pipes:[p.Ov,p.uU],styles:[""]}),r})();var h=d(1777),a=d(3075),q=d(1588),x=d(946);const L=["app-set-editor",""];function J(r,n){if(1&r&&(t.TgZ(0,"option",6),t._uU(1),t.qZA()),2&r){const e=n.$implicit;t.Q6J("value",e.id),t.xp6(1),t.Oqu(e.name)}}let O=(()=>{class r{constructor(){this.exerciseError=!1,this.exerciseList=[],this.newExerciseSelected=new t.vpe}ngOnInit(){}onExerciseSelectionChange(e){this.newExerciseSelected.emit()}}return r.\u0275fac=function(e){return new(e||r)},r.\u0275cmp=t.Xpm({type:r,selectors:[["","app-set-editor",""]],inputs:{exerciseError:"exerciseError",exerciseList:"exerciseList",form:"form"},outputs:{newExerciseSelected:"newExerciseSelected"},attrs:L,decls:10,vars:4,consts:[[3,"formGroup"],["formControlName","exerciseId",1,"form-control",3,"change"],[3,"value",4,"ngFor","ngForOf"],["type","number","id","weight","formControlName","weight","min","0","step","1",1,"form-control"],["type","number","id","reps","formControlName","reps","min","0","step","1",1,"form-control"],["type","number","id","rpe","formControlName","rpe","min","0","max","10","step","0.5",1,"form-control"],[3,"value"]],template:function(e,o){1&e&&(t.ynx(0,0),t.TgZ(1,"td")(2,"select",1),t.NdJ("change",function(s){return o.onExerciseSelectionChange(s)}),t.YNc(3,J,2,2,"option",2),t.qZA()(),t.TgZ(4,"td"),t._UZ(5,"input",3),t.qZA(),t.TgZ(6,"td"),t._UZ(7,"input",4),t.qZA(),t.TgZ(8,"td"),t._UZ(9,"input",5),t.qZA(),t.BQk()),2&e&&(t.Q6J("formGroup",o.form),t.xp6(2),t.ekj("is-invalid",o.exerciseError),t.xp6(1),t.Q6J("ngForOf",o.exerciseList))},directives:[a.JL,a.sg,a.EJ,a.JJ,a.u,p.sg,a.YN,a.Kr,a.wV,a.qQ,a.Fj,a.Fd],styles:["td[_ngcontent-%COMP%]{padding-left:.1rem;padding-right:.1rem}"],changeDetection:0}),r})(),B=(()=>{class r{constructor(){this.seconds="",this.minutes="",this.renderTimerOnLoop()}renderTimerOnLoop(){setInterval(()=>{const i=new Date(Date()).getTime()-this.lastSetLogged.getTime();this.minutes=this.padTimeTwoDecimals(Math.floor(i/6e4)),this.seconds=this.padTimeTwoDecimals(Math.floor(i%6e4/1e3))},1e3)}padTimeTwoDecimals(e){return e<10?"0"+e:e.toString()}ngOnInit(){}}return r.\u0275fac=function(e){return new(e||r)},r.\u0275cmp=t.Xpm({type:r,selectors:[["app-rest-time"]],inputs:{lastSetLogged:"lastSetLogged"},decls:1,vars:2,template:function(e,o){1&e&&t._uU(0),2&e&&t.AsE("Rest time: ",o.minutes,":",o.seconds,"")},styles:[""]}),r})();function M(r,n){if(1&r){const e=t.EpF();t.TgZ(0,"div",6),t.NdJ("click",function(){return t.CHM(e),t.oxw().closeEvent.emit()}),t.qZA()}}const Y=["*"];let Q=(()=>{class r{constructor(){this.title="",this.show=!1,this.closeEvent=new t.vpe}ngOnInit(){}}return r.\u0275fac=function(e){return new(e||r)},r.\u0275cmp=t.Xpm({type:r,selectors:[["app-off-canvas"]],inputs:{title:"title",show:"show"},outputs:{closeEvent:"closeEvent"},ngContentSelectors:Y,decls:8,vars:4,consts:[["id","page-mask",3,"click",4,"ngIf"],["tabindex","-1","role","dialog",1,"offcanvas","offcanvas-start"],[1,"offcanvas-header"],[1,"offcanvas-title"],["type","button","aria-label","Close",1,"btn-close","text-reset",3,"click"],[1,"offcanvas-body"],["id","page-mask",3,"click"]],template:function(e,o){1&e&&(t.F$t(),t.YNc(0,M,1,0,"div",0),t.TgZ(1,"div",1)(2,"div",2)(3,"h5",3),t._uU(4),t.qZA(),t.TgZ(5,"button",4),t.NdJ("click",function(){return o.closeEvent.emit()}),t.qZA()(),t.TgZ(6,"div",5),t.Hsn(7),t.qZA()()),2&e&&(t.Q6J("ngIf",o.show),t.xp6(1),t.ekj("show",o.show),t.xp6(3),t.Oqu(o.title))},directives:[p.O5],styles:[""]}),r})();var H=d(3300);function $(r,n){if(1&r&&(t.TgZ(0,"label",18),t._uU(1),t.qZA()),2&r){const e=t.oxw();t.xp6(1),t.Oqu(e.getErrors("date"))}}function P(r,n){if(1&r&&(t.TgZ(0,"label",18),t._uU(1),t.qZA()),2&r){const e=t.oxw();t.xp6(1),t.Oqu(e.getErrors("title"))}}function R(r,n){if(1&r&&(t.TgZ(0,"label",18),t._uU(1),t.qZA()),2&r){const e=t.oxw();t.xp6(1),t.Oqu(e.getErrors("bodyweight"))}}function j(r,n){if(1&r&&(t.TgZ(0,"label",18),t._uU(1),t.qZA()),2&r){const e=t.oxw(2);t.xp6(1),t.Oqu(e.getErrors("notes"))}}function z(r,n){if(1&r&&(t.TgZ(0,"div",3)(1,"label"),t._uU(2,"Notes"),t.qZA(),t._UZ(3,"textarea",19),t.YNc(4,j,2,1,"label",7),t.qZA()),2&r){const e=t.oxw();t.xp6(4),t.Q6J("ngIf",e.getErrors("notes"))}}function G(r,n){if(1&r&&(t.TgZ(0,"button",20),t._uU(1,"Cancel"),t.qZA()),2&r){const e=t.oxw();t.ekj("disabled",!e.enableSubmit)}}let T=(()=>{class r{constructor(e,o,i){this.workouts=e,this.toast=o,this.fb=i,this.workoutId=null,this.workoutData=null,this.updateComplete=new t.vpe,this.pickerDate={year:1789,month:7,day:14},this.pickerTime={hour:0,minute:0},this.validationErrors={title:{maxlength:"Title cannot exceed 255 characters"},date:{required:"Please enter a valid date with format yyyy-mm-dd"},bodyweight:{min:"Bodyweight cannot be negative",max:"Bodyweight cannot be more than 1000"},notes:{maxlength:"Your notes are too long"}},this.enableSubmit=!0,this.subs=new _.Y,this.form=i.group({title:["",[a.kI.maxLength(255)]],date:["",[a.kI.required]],time:[""],bodyweight:["",[a.kI.min(0),a.kI.max(1e3)]],bodyweightUnit:[""],notes:["",[a.kI.maxLength(2048)]]})}ngOnDestroy(){this.subs.unsubscribe()}getErrors(e){var o,i,s;if(null!==(i=null===(o=this.form.get(e))||void 0===o?void 0:o.errors)&&void 0!==i&&i){const l=Object.keys(null===(s=this.form.get(e))||void 0===s?void 0:s.errors)[0];try{return this.validationErrors[e][l]}catch(c){return console.error("Error getting validation string: "+c),"Error validating this field"}}return null}bindInputDateToPicker(){if(null==this.workoutData)throw"Cannot bind date to null workout";const e=new Date(this.workoutData.entryDateUTC),o={year:e.getFullYear(),month:e.getMonth()+1,day:e.getDate()};this.pickerDate=o;const i={hour:e.getHours(),minute:e.getMinutes()};this.pickerTime=i}bindFormToWorkout(){if(null==this.workoutData)throw"Cannot bind form to null workout";this.form.setValue({title:this.workoutData.title,date:"",time:"",bodyweight:this.workoutData.bodyweight,bodyweightUnit:this.workoutData.bodyweightUnit,notes:this.workoutData.notes})}ngOnInit(){null!=this.workoutData&&(this.bindFormToWorkout(),this.bindInputDateToPicker())}ngOnChanges(){null!=this.workoutData&&(this.bindFormToWorkout(),this.bindInputDateToPicker())}getDate(e=!0){const o=this.form.value.date,i=this.form.value.time;let s=`${o.year}-${o.month}-${o.day}`;return i&&(s+=` ${i.hour}:${i.minute}`),e&&(s+=" UTC"),new Date(s)}onSubmit(){this.enableSubmit=!1;const e=this.getDate(!1),o={title:this.form.value.title,entryDateUTC:this.getDate(),bodyweight:this.form.value.bodyweight,bodyweightUnit:this.form.value.bodyweightUnit,notes:this.form.value.notes};if(null!=this.workoutId){const i=this.workoutId;this.subs.sink=this.workouts.updateWorkout(i,o).subscribe(()=>{this.toast.setToast({message:"Workout updated",domClass:"bg-success text-light"}),o.entryDateUTC=e,this.updateComplete.emit(Object.assign(Object.assign({},o),{id:i})),this.enableSubmit=!0})}else this.subs.sink=this.workouts.createWorkout(o).subscribe(i=>{this.toast.setToast({message:"Workout created",domClass:"bg-success text-light"}),o.entryDateUTC=e,this.updateComplete.emit(Object.assign(Object.assign({},o),{id:i}))})}}return r.\u0275fac=function(e){return new(e||r)(t.Y36(m),t.Y36(H.k),t.Y36(a.qu))},r.\u0275cmp=t.Xpm({type:r,selectors:[["app-workout-details-editor"]],inputs:{workoutId:"workoutId",workoutData:"workoutData"},outputs:{updateComplete:"updateComplete"},features:[t.TTD],decls:39,vars:11,consts:[[1,"row"],["cardTitle","Workout Details"],["id","validation-form",3,"formGroup","ngSubmit"],[1,"mb-3","error-placeholder"],["placeholder","yyyy-mm-dd","name","dp","ngbDatepicker","","id","date","formControlName","date",1,"form-control",3,"ngModel","ngModelChange"],["d","ngbDatepicker"],["type","button",1,"btn","btn-outline-secondary","bi","bi-calendar3","mt-2",3,"click"],["id","validation-file-error","class","error jquery-validation-error small form-text invalid-feedback","for","validation-file","style","display: inline-block;",4,"ngIf"],["formControlName","time",3,"ngModel","ngModelChange"],["type","text","id","title","formControlName","title",1,"form-control"],["type","number","min","0","max","1000","id","bodyweight","formControlName","bodyweight",1,"form-control"],[1,"form-check","form-check-inline"],["type","radio","name","bodyweightUnit","value","lbs","formControlName","bodyweightUnit",1,"form-check-input"],[1,"form-check-label"],["type","radio","name","bodyweightUnit","value","kg","formControlName","bodyweightUnit",1,"form-check-input"],["class","mb-3 error-placeholder",4,"ngIf"],["type","submit",1,"btn","btn-sm","btn-primary"],["class","btn btn-sm btn-secondary","routerLink","/workouts",3,"disabled",4,"ngIf"],["id","validation-file-error","for","validation-file",1,"error","jquery-validation-error","small","form-text","invalid-feedback",2,"display","inline-block"],["type","text","id","notes","formControlName","notes",1,"form-control",2,"height","200px"],["routerLink","/workouts",1,"btn","btn-sm","btn-secondary"]],template:function(e,o){if(1&e){const i=t.EpF();t.TgZ(0,"div",0)(1,"app-card",1)(2,"form",2),t.NdJ("ngSubmit",function(){return o.onSubmit()}),t.TgZ(3,"div",3)(4,"label"),t._uU(5,"Date"),t.qZA(),t.TgZ(6,"input",4,5),t.NdJ("ngModelChange",function(l){return o.pickerDate=l}),t.qZA(),t.TgZ(8,"button",6),t.NdJ("click",function(){return t.CHM(i),t.MAs(7).toggle()}),t._uU(9,"Pick Date"),t.qZA(),t.YNc(10,$,2,1,"label",7),t.qZA(),t.TgZ(11,"div",3)(12,"label"),t._uU(13,"Time"),t.qZA(),t.TgZ(14,"ngb-timepicker",8),t.NdJ("ngModelChange",function(l){return o.pickerTime=l}),t.qZA()(),t.TgZ(15,"div",3)(16,"label"),t._uU(17,"Title"),t.qZA(),t._UZ(18,"input",9),t.YNc(19,P,2,1,"label",7),t.qZA(),t.TgZ(20,"div",3)(21,"label"),t._uU(22,"Bodyweight"),t.qZA(),t._UZ(23,"input",10),t.YNc(24,R,2,1,"label",7),t._UZ(25,"br"),t.TgZ(26,"label",11),t._UZ(27,"input",12),t.TgZ(28,"span",13),t._uU(29," lbs "),t.qZA()(),t.TgZ(30,"label",11),t._UZ(31,"input",14),t.TgZ(32,"span",13),t._uU(33," kg "),t.qZA()()(),t.YNc(34,z,5,1,"div",15),t.TgZ(35,"div")(36,"button",16),t._uU(37),t.qZA(),t.YNc(38,G,2,2,"button",17),t.qZA()()()()}2&e&&(t.xp6(2),t.Q6J("formGroup",o.form),t.xp6(4),t.Q6J("ngModel",o.pickerDate),t.xp6(4),t.Q6J("ngIf",o.getErrors("date")),t.xp6(4),t.Q6J("ngModel",o.pickerTime),t.xp6(5),t.Q6J("ngIf",o.getErrors("title")),t.xp6(5),t.Q6J("ngIf",o.getErrors("bodyweight")),t.xp6(10),t.Q6J("ngIf",o.workoutId),t.xp6(2),t.ekj("disabled",!o.enableSubmit||!o.form.valid),t.xp6(1),t.Oqu(o.workoutId?"Update":"Create"),t.xp6(1),t.Q6J("ngIf",!o.workoutId))},directives:[f.A,a._Y,a.JL,a.sg,k.J4,a.Fj,a.JJ,a.u,p.O5,k.Pm,a.qQ,a.Fd,a.wV,a._,g.rH],styles:[""]}),r})();var V=d(9873),X=d(8028);function K(r,n){if(1&r){const e=t.EpF();t.TgZ(0,"tr",31),t.NdJ("click",function(){t.CHM(e);const i=t.oxw().$implicit;return t.oxw(2).startUpdatingSet(i.id)})("dragstart",function(i){t.CHM(e);const s=t.oxw().$implicit;return t.oxw(2).rowDragStart(i,s.id)})("dragend",function(i){t.CHM(e);const s=t.oxw().$implicit;return t.oxw(2).rowDragEnd(i,s.id)})("dragover",function(i){t.CHM(e);const s=t.oxw().$implicit;return t.oxw(2).rowDragOver(i,s.id)})("drop",function(i){t.CHM(e);const s=t.oxw().$implicit;return t.oxw(2).rowDrop(i,s.id)}),t.TgZ(1,"td"),t._uU(2),t.qZA(),t.TgZ(3,"td"),t._uU(4),t.qZA(),t.TgZ(5,"td"),t._uU(6),t.qZA(),t.TgZ(7,"td"),t._uU(8),t.ALo(9,"rpe"),t.qZA()()}if(2&r){const e=t.oxw().$implicit,o=t.oxw(2);t.ekj("drag-transparent",e.id==o.dragId)("drag-border",e.id==o.dropId),t.Q6J("draggable",!o.setBeingUpdated&&!o.addingSet)("@flyIn",o.lastSetAddedId==e.id?"in":""),t.xp6(2),t.Oqu(e.exerciseName),t.xp6(2),t.AsE("",e.weight," ",e.weight?e.weightUnit:"",""),t.xp6(2),t.Oqu(e.reps),t.xp6(2),t.Oqu(t.lcZ(9,11,e.rpe))}}function tt(r,n){if(1&r&&t._UZ(0,"tr",32),2&r){const e=t.oxw(3);t.Q6J("exerciseError",e.anyErrors("exerciseId"))("exerciseList",e.exerciseList)("form",e.updateSetForm)}}function et(r,n){if(1&r&&(t.ynx(0,19),t.YNc(1,K,10,13,"tr",29),t.YNc(2,tt,1,3,"tr",30),t.BQk()),2&r){const e=n.$implicit,o=t.oxw(2);t.Q6J("ngSwitch",e.id==o.setBeingUpdated),t.xp6(1),t.Q6J("ngSwitchCase",!1),t.xp6(1),t.Q6J("ngSwitchCase",!0)}}function ot(r,n){if(1&r){const e=t.EpF();t.TgZ(0,"tr",33),t.NdJ("newExerciseSelected",function(){return t.CHM(e),t.oxw(2).differentExerciseSelectedForNewSet()}),t.qZA()}if(2&r){const e=t.oxw(2);t.Q6J("exerciseError",e.anyErrors("exerciseId"))("exerciseList",e.exerciseList)("form",e.newSetForm)}}function rt(r,n){1&r&&(t.TgZ(0,"tr")(1,"td"),t._uU(2,"\xa0"),t.qZA(),t._UZ(3,"td")(4,"td")(5,"td"),t.qZA())}function it(r,n){if(1&r){const e=t.EpF();t.TgZ(0,"button",24),t.NdJ("click",function(){return t.CHM(e),t.oxw(2).logNewSet(!0)}),t._uU(1," Add and Complete "),t.qZA()}if(2&r){const e=t.oxw(2);t.ekj("disabled",e.addingSet||!e.newSetForm.valid)}}function nt(r,n){if(1&r){const e=t.EpF();t.TgZ(0,"button",27),t.NdJ("click",function(){return t.CHM(e),t.oxw(2).deleteSet()}),t._uU(1,"Delete"),t.qZA()}if(2&r){const e=t.oxw(2);t.ekj("disabled",e.addingSet)}}function st(r,n){if(1&r){const e=t.EpF();t.TgZ(0,"button",27),t.NdJ("click",function(){return t.CHM(e),t.oxw(2).stopUpdatingSet()}),t._uU(1,"Cancel"),t.qZA()}if(2&r){const e=t.oxw(2);t.ekj("disabled",e.addingSet)}}function at(r,n){if(1&r){const e=t.EpF();t.TgZ(0,"div",34)(1,"button",27),t.NdJ("click",function(){return t.CHM(e),t.oxw(2).moveDown()}),t._uU(2,"Move Down"),t.qZA(),t.TgZ(3,"button",27),t.NdJ("click",function(){return t.CHM(e),t.oxw(2).moveUp()}),t._uU(4,"Move Up"),t.qZA()()}if(2&r){const e=t.oxw(2);t.xp6(1),t.ekj("disabled",e.addingSet||e.indexOfSetBeingUpdate()==e.numberOfSets()-1),t.xp6(2),t.ekj("disabled",e.addingSet||0==e.indexOfSetBeingUpdate())}}function dt(r,n){if(1&r){const e=t.EpF();t.TgZ(0,"div")(1,"table",15)(2,"thead")(3,"tr")(4,"th",16),t._uU(5,"Exercise *"),t.qZA(),t.TgZ(6,"th",17),t._uU(7,"Weight"),t.qZA(),t.TgZ(8,"th",17),t._uU(9,"Reps"),t.qZA(),t.TgZ(10,"th",17),t._uU(11,"RPE"),t.qZA()()(),t.TgZ(12,"tbody"),t.YNc(13,et,3,3,"ng-container",18),t.ynx(14,19),t.YNc(15,ot,1,3,"tr",20),t.YNc(16,rt,6,0,"tr",21),t.BQk(),t.qZA()(),t.TgZ(17,"div",22)(18,"div"),t._UZ(19,"app-rest-time",23),t.qZA(),t.TgZ(20,"div")(21,"button",24),t.NdJ("click",function(){return t.CHM(e),t.oxw().logNewSet()}),t._uU(22),t.qZA(),t.YNc(23,it,2,2,"button",25),t.YNc(24,nt,2,2,"button",26),t.YNc(25,st,2,2,"button",26),t.TgZ(26,"button",27),t.NdJ("click",function(){return t.CHM(e),t.oxw().showHistoryPopover()}),t._uU(27,"History"),t.qZA()(),t.YNc(28,at,5,4,"div",28),t.qZA()()}if(2&r){const e=t.oxw();t.xp6(13),t.Q6J("ngForOf",e.workout.sets),t.xp6(1),t.Q6J("ngSwitch",!!e.setBeingUpdated),t.xp6(1),t.Q6J("ngSwitchCase",!1),t.xp6(1),t.Q6J("ngSwitchCase",!0),t.xp6(3),t.Q6J("lastSetLogged",e.lastSetLogged),t.xp6(2),t.ekj("disabled",e.addingSet||!(e.setBeingUpdated?e.updateSetForm.valid:e.newSetForm.valid)),t.xp6(1),t.hij(" ",e.setBeingUpdated?"Update":"Add"," "),t.xp6(1),t.Q6J("ngIf",!e.setBeingUpdated),t.xp6(1),t.Q6J("ngIf",e.setBeingUpdated),t.xp6(1),t.Q6J("ngIf",e.setBeingUpdated),t.xp6(3),t.Q6J("ngIf",e.setBeingUpdated)}}function lt(r,n){1&r&&(t.TgZ(0,"div",35)(1,"div",36)(2,"span",37),t._uU(3,"Loading..."),t.qZA()()())}let ut=(()=>{class r{constructor(e,o,i,s){this.route=e,this.workouts=o,this.config=i,this.router=s,this.loadingSets=!1,this.loadingExercises=!0,this.addingSet=!1,this.setBeingUpdated=null,this.exerciseList=[],this.dragId=null,this.dropId=null,this.showHistory=!1,this.showDetailsEditor=!1,this.lastSetLogged=new Date(Date()),this.sharedSetForm=new a.cw({weightUnit:new a.NI(this.config.getPreferredWeigthUnit())}),this.updateSetForm=r.createSetForm(),this.newSetForm=r.createSetForm(),this.subs=new _.Y}ngOnDestroy(){this.subs.unsubscribe()}static createSetForm(){return new a.cw({exerciseId:new a.NI(null,[a.kI.required]),reps:new a.NI,targetReps:new a.NI,weight:new a.NI,rpe:new a.NI(null,[a.kI.min(0),a.kI.max(10)])})}ngOnInit(){this.loadingExercises=!1,this.workout=this.route.snapshot.data.workout.workout,this.exerciseList=this.route.snapshot.data.workout.exerciseList,this.subs.sink=this.route.paramMap.subscribe(e=>{this.showHistory="true"==e.get("showHistory"),this.showDetailsEditor="true"==e.get("showDetails")})}anyUnsavedChanges(){if(this.addingSet)return!1;if(null!=this.setBeingUpdated)return!0;const e=this.newSetForm.value;return null!=e.reps||null!=e.targetReps||null!=e.weight||null!=e.rpe}logNewSet(e=!1){var o,i,s;const c=(this.setBeingUpdated?this.updateSetForm:this.newSetForm).value,u={id:null!==(o=this.setBeingUpdated)&&void 0!==o?o:(0,q.Z)(),exerciseId:c.exerciseId,exerciseName:null!==(s=null===(i=this.exerciseList.find(w=>w.id==c.exerciseId))||void 0===i?void 0:i.name)&&void 0!==s?s:"",reps:c.reps,targetReps:c.targetReps,weight:c.weight,weightUnit:this.sharedSetForm.value.weightUnit,rpe:2*c.rpe};this.addingSet=!0,this.subs.sink=this.workouts.syncSet(this.workout.id,u).subscribe(()=>{if(this.setBeingUpdated){const w=this.workout.sets.findIndex(vt=>vt.id==this.setBeingUpdated);this.workout.sets[w]=u,this.setBeingUpdated=null}else this.lastSetAddedId=u.id,this.lastSetLogged=new Date(Date()),this.workout.sets.push(u);e?this.router.navigate(["/workouts"]):this.addingSet=!1})}startUpdatingSet(e){if(this.setBeingUpdated==e)return;const o=this.workout.sets.find(i=>i.id==e);this.updateSetForm.setValue({exerciseId:null==o?void 0:o.exerciseId,reps:null==o?void 0:o.reps,targetReps:null==o?void 0:o.targetReps,weight:null==o?void 0:o.weight,rpe:(null==o?void 0:o.rpe)?(null==o?void 0:o.rpe)/2:null}),this.sharedSetForm.setValue({weightUnit:null==o?void 0:o.weightUnit}),this.setBeingUpdated=e,this.lastSetAddedId=void 0}stopUpdatingSet(){this.setBeingUpdated=null}deleteSet(){if(this.addingSet=!0,!this.setBeingUpdated)throw"Tried deleting set but none selected";const e=this.setBeingUpdated;this.subs.sink=this.workouts.deleteSet(this.workout.id,e).subscribe(()=>{this.setBeingUpdated=null,this.workout.sets=this.workout.sets.filter(o=>o.id!=e),this.addingSet=!1})}rowDragStart(e,o){this.dragId=o,e.dataTransfer.setData("application/my-app",o),e.dataTransfer.dropEffect="move"}rowDragEnd(e,o){this.dragId=null,this.dropId=null}rowDragOver(e,o){e.preventDefault(),this.dropId=o}rowDrop(e,o){if(null!=this.dragId&&null!=this.dropId&&this.dragId!=this.dropId){let i=[];const s=this.workout.sets.findIndex(u=>u.id==this.dragId),l=this.workout.sets.findIndex(u=>u.id==this.dropId);for(let u=0;u<this.workout.sets.length;u++)i.push(u<s&&u<l||u>s&&u>l?this.workout.sets[u]:u==l?this.workout.sets[s]:s<l?this.workout.sets[u+1]:this.workout.sets[u-1]);this.workout.sets=i;let c=i.map(u=>u.id);this.addingSet=!0,this.subs.sink=this.workouts.updateWorkoutSetSequence(this.workout.id,c).subscribe(()=>{this.addingSet=!1})}}moveUp(){if(!this.setBeingUpdated)throw"There is no set being updated";const e=this.indexOfSetBeingUpdate();if(0==e)return;const o=[...this.workout.sets];o[e-1]=this.workout.sets[e],o[e]=this.workout.sets[e-1],this.workout.sets=o;let i=o.map(s=>s.id);this.addingSet=!0,this.subs.sink=this.workouts.updateWorkoutSetSequence(this.workout.id,i).subscribe(()=>{this.addingSet=!1})}moveDown(){if(!this.setBeingUpdated)throw"There is no set being updated";const e=this.indexOfSetBeingUpdate();if(e==this.workout.sets.length-1)return;const o=[...this.workout.sets];o[e+1]=this.workout.sets[e],o[e]=this.workout.sets[e+1],this.workout.sets=o;let i=o.map(s=>s.id);this.addingSet=!0,this.subs.sink=this.workouts.updateWorkoutSetSequence(this.workout.id,i).subscribe(()=>{this.addingSet=!1})}indexOfSetBeingUpdate(){if(!this.setBeingUpdated)throw"There is no set being updated";return this.workout.sets.findIndex(e=>e.id==this.setBeingUpdated)}numberOfSets(){return this.workout.sets.length}onWorkoutUpdateComplete(e){this.closePopover(),this.workout.entryDateUTC=e.entryDateUTC}differentExerciseSelectedForNewSet(){this.newSetForm.setValue({exerciseId:this.newSetForm.value.exerciseId,reps:null,targetReps:null,weight:null,rpe:null})}closePopover(){this.router.navigate([{}],{relativeTo:this.route})}showHistoryPopover(){this.router.navigate([{showHistory:!0}],{relativeTo:this.route})}showDetailsPopover(){this.router.navigate([{showDetails:!0}],{relativeTo:this.route})}anyErrors(e){return this.setBeingUpdated?!!this.updateSetForm.controls[e].errors:!!this.newSetForm.controls[e].errors}}return r.\u0275fac=function(e){return new(e||r)(t.Y36(g.gz),t.Y36(m),t.Y36(x.E),t.Y36(g.F0))},r.\u0275cmp=t.Xpm({type:r,selectors:[["app-edit-workout"]],decls:33,vars:15,consts:[[1,"h3","mb-3"],[1,"btn","btn-primary",3,"click"],["cardTitle","Workout Sets",3,"collapseBody"],[3,"formGroup"],[2,"padding-left","20px"],[1,"form-check","form-check-inline"],["type","radio","name","weightUnit","value","lbs","formControlName","weightUnit",1,"form-check-input"],[1,"form-check-label"],["type","radio","name","weightUnit","value","kg","formControlName","weightUnit",1,"form-check-input"],[4,"ngIf","ngIfElse"],["loading",""],["title","Workout Details",3,"show","closeEvent"],[3,"workoutId","workoutData","updateComplete"],["title","Exercise History",3,"show","closeEvent"],[3,"exerciseId","displayKg","excludeWorkoutId"],[1,"table","table-striped","no-footer","table-hover",2,"width","100%"],[2,"width","55%"],[2,"width","15%"],[3,"ngSwitch",4,"ngFor","ngForOf"],[3,"ngSwitch"],["app-set-editor","",3,"exerciseError","exerciseList","form","newExerciseSelected",4,"ngSwitchCase"],[4,"ngSwitchCase"],[1,"card-footer"],[3,"lastSetLogged"],[1,"btn","btn-primary","btn-sm",3,"click"],["class","btn btn-primary btn-sm",3,"disabled","click",4,"ngIf"],["class","btn btn-secondary btn-sm",3,"disabled","click",4,"ngIf"],[1,"btn","btn-secondary","btn-sm",3,"click"],["class","pt-3",4,"ngIf"],["class","cursor-grab",3,"draggable","drag-transparent","drag-border","click","dragstart","dragend","dragover","drop",4,"ngSwitchCase"],["app-set-editor","",3,"exerciseError","exerciseList","form",4,"ngSwitchCase"],[1,"cursor-grab",3,"draggable","click","dragstart","dragend","dragover","drop"],["app-set-editor","",3,"exerciseError","exerciseList","form"],["app-set-editor","",3,"exerciseError","exerciseList","form","newExerciseSelected"],[1,"pt-3"],[1,"mb-2","text-center"],["role","status",1,"spinner-grow","me-2"],[1,"sr-only"]],template:function(e,o){if(1&e&&(t.TgZ(0,"h1",0),t._uU(1),t.ALo(2,"date"),t.TgZ(3,"button",1),t.NdJ("click",function(){return o.showDetailsPopover()}),t._uU(4,"Edit Details"),t.qZA()(),t.TgZ(5,"div")(6,"app-card",2)(7,"div",3)(8,"div",4)(9,"label"),t._uU(10,"Editor help: "),t.qZA(),t.TgZ(11,"ul")(12,"li"),t._uU(13,"Click on a row to edit"),t.qZA(),t.TgZ(14,"li"),t._uU(15,"Drag and drop a row to change the sequence"),t.qZA()()(),t.TgZ(16,"label",5),t._uU(17,"Weight unit:"),t.qZA(),t.TgZ(18,"label",5),t._UZ(19,"input",6),t.TgZ(20,"span",7),t._uU(21," lbs "),t.qZA()(),t.TgZ(22,"label",5),t._UZ(23,"input",8),t.TgZ(24,"span",7),t._uU(25," kg "),t.qZA()()(),t.YNc(26,dt,29,12,"div",9),t.YNc(27,lt,4,0,"ng-template",null,10,t.W1O),t.qZA()(),t.TgZ(29,"app-off-canvas",11),t.NdJ("closeEvent",function(){return o.closePopover()}),t.TgZ(30,"app-workout-details-editor",12),t.NdJ("updateComplete",function(s){return o.onWorkoutUpdateComplete(s)}),t.qZA()(),t.TgZ(31,"app-off-canvas",13),t.NdJ("closeEvent",function(){return o.closePopover()}),t._UZ(32,"app-exercise-history",14),t.qZA()),2&e){const i=t.MAs(28);t.xp6(1),t.hij("Editing workout ",t.xi3(2,12,o.workout.entryDateUTC,"short")," "),t.xp6(5),t.Q6J("collapseBody",!0),t.xp6(1),t.Q6J("formGroup",o.sharedSetForm),t.xp6(19),t.Q6J("ngIf",!o.loadingSets&&!o.loadingExercises&&o.workout)("ngIfElse",i),t.xp6(3),t.Q6J("show",o.showDetailsEditor),t.xp6(1),t.Q6J("workoutId",o.workout.id)("workoutData",o.workout),t.xp6(1),t.Q6J("show",o.showHistory),t.xp6(1),t.Q6J("exerciseId",o.setBeingUpdated?o.updateSetForm.value.exerciseId:o.newSetForm.value.exerciseId)("displayKg","kg"==o.sharedSetForm.value.weightUnit)("excludeWorkoutId",o.workout.id)}},directives:[f.A,a.JL,a.sg,a._,a.Fj,a.JJ,a.u,p.O5,p.sg,p.RF,p.n9,O,B,Q,T,V._],pipes:[p.uU,X.C],styles:[".drag-transparent[_ngcontent-%COMP%]{opacity:.5}.drag-border[_ngcontent-%COMP%]{border:3px dotted #666}.form-control.is-invalid[_ngcontent-%COMP%], .was-validated[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%]:invalid{border-color:#dc3545;border-width:3px;padding-right:calc(1.5em + .75rem)}"],data:{animation:[(0,h.X$)("flyIn",[(0,h.SB)("in",(0,h.oB)({transform:"translateY(0)"})),(0,h.eR)("void => in",[(0,h.oB)({transform:"translateY(-100%)"}),(0,h.jt)(100)])])]}}),r})(),ct=(()=>{class r{constructor(e,o,i){this.workouts=e,this.router=o,this.config=i,this.workoutData={title:"",entryDateUTC:new Date,bodyweight:null,bodyweightUnit:this.config.getPreferredWeigthUnit(),notes:""}}ngOnInit(){}updateDone(e){this.router.navigate(["workouts",e.id,"edit"])}}return r.\u0275fac=function(e){return new(e||r)(t.Y36(m),t.Y36(g.F0),t.Y36(x.E))},r.\u0275cmp=t.Xpm({type:r,selectors:[["app-new-workout"]],decls:1,vars:1,consts:[[3,"workoutData","updateComplete"]],template:function(e,o){1&e&&(t.TgZ(0,"app-workout-details-editor",0),t.NdJ("updateComplete",function(s){return o.updateDone(s)}),t.qZA()),2&e&&t.Q6J("workoutData",o.workoutData)},directives:[T],styles:[""]}),r})(),C=(()=>{class r{constructor(){}getBasePath(e){const o=e.indexOf(";");return e.substring(0,-1==o?e.length:o)}baseUrlChanged(e,o){return this.getBasePath(e)!=this.getBasePath(o)}}return r.\u0275fac=function(e){return new(e||r)},r.\u0275prov=t.Yz7({token:r,factory:r.\u0275fac,providedIn:"root"}),r})(),pt=(()=>{class r{constructor(e){this.pathsHelper=e}canActivate(e,o){return!0}canDeactivate(e,o,i,s){var l;return!this.pathsHelper.baseUrlChanged(i.url,null!==(l=null==s?void 0:s.url)&&void 0!==l?l:"")||!e.anyUnsavedChanges()||confirm("You have a set entered that hasn't been saved. Navigate away and lose changes?")}}return r.\u0275fac=function(e){return new(e||r)(t.LFG(C))},r.\u0275prov=t.Yz7({token:r,factory:r.\u0275fac,providedIn:"root"}),r})();var gt=d(9646),ht=d(4128),mt=d(6281);let _t=(()=>{class r{constructor(e,o,i,s){this.workout=e,this.router=o,this.pathsHelper=i,this.exercise=s}resolve(e,o){if(!this.pathsHelper.baseUrlChanged(this.router.url,o.url))return(0,gt.of)(null);const i=e.paramMap.get("id");if(null==i)throw"Null workout id in route";const s=this.workout.getWorkout(i),l=this.exercise.getAllExercises();return(0,ht.D)([s,l]).pipe((0,b.U)(c=>({workout:c[0],exerciseList:c[1].data})))}}return r.\u0275fac=function(e){return new(e||r)(t.LFG(m),t.LFG(g.F0),t.LFG(C),t.LFG(mt.z))},r.\u0275prov=t.Yz7({token:r,factory:r.\u0275fac,providedIn:"root"}),r})();var ft=d(4466);const kt=[{path:"",component:F},{path:"new",component:ct},{path:":id/edit",component:ut,canDeactivate:[pt],resolve:{workout:_t}}];let wt=(()=>{class r{}return r.\u0275fac=function(e){return new(e||r)},r.\u0275mod=t.oAB({type:r}),r.\u0275inj=t.cJS({imports:[[g.Bz.forChild(kt),ft.m]]}),r})()}}]);